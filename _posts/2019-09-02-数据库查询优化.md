---
layout: post
title: '数据库查询优化'
date: 2019-09-02
author: smakry
tags: 数据库 优化 sql 索引
---

> 细微之处，拥抱百万变化

简单的一个优化即可将效率提升N个档次。优化的精髓所在个人认为在于索引的微妙。“索引”跟查字典、地图上定位本质上都是通过不断的缩小结果集快速查找定位。

### 数据库索引
#### 索引的数据结构（b+树）

大多的项目对数据的写入操作与读取操作占比大致在1：10，一定程度上把矛头指向了读操作的优化。IO操作的低效性，操作系统有做了对应的优化，在读取时不止读取检索的磁盘同时也读取了相邻的区块（以“页”的方式读取，减少IO操作）。

![b+数据结构](https://github.com/smakry/smakry.github.io/raw/master/imags/2019-09-02-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/b%2Btreemap.png?raw=true)

1. mysql使用B+树存储（同大部分的文件系统）
    - B+树IO搜索：  
搜索高度h = log（每个磁盘块的数据项数量m + 1）数据表的数据N  
即当m越大，h越小  
m = 磁盘块的大小 / 数据项的大小  
=====引出数据库表索引字段大小问题

2. 索引分类

````sql
CREATE TABLE `vip` (
	`id` int(4),
	`name` varchar(10),
	`idcard` varchar(18),
	`phone` varchar(11),
	`address` varchar(50),
	`notemsg` text,
	primary key (id),		#唯一索引=》主键索引（加速查找+约束，不为空且唯一）
	unique(idcard),			#唯一索引（加速查找+约束，唯一）
	index(phone),			#普通索引（加速查找）
	fulltext(notemsg)		#全文索引（用于搜索很长文本的时候，效果最好）
);

#联合索引=》联合主键索引：primary key(id,name)
#联合索引=》联合唯一索引：unique(id,name)
#联合索引=》联合普通索引：index(id,name)
#空间索引（较少使用）
````

### 优化性能方面：

1.使索引弱化掉的操作
2.减少不必要的数据输出
- 

问题：
存储过程？
