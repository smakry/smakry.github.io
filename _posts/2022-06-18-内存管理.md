---
layout: post
title: '内存管理'
date: 2022-06-18
author: smakry
tags: 内存分配 垃圾收集 栈内存管理
---

>

### 内存分配

1. 线性分配器
2. 空闲链表分配器

#### 分配应用

1. 业务模块预分配空间
    - 业务内存空间相对固定，重用内存分配相关的从该空间释放及分配
    - 业务波动场景，内存申请可能存在资源浪费
    - 空间固定，不利于伸缩
    - 减少产生内存碎片的可能
    - 适用场景内存块申请空间大
    - 读多写少的情况

2. 空闲内存块分配
    - 业务申请的内存块相对小
    - 频繁读写
    - 系统调用带来的切换
    
    2.1 首次适应（循环找到第一个足够的内存块）
    2.2 循环首次适应（从上次找的可使用的内存点之后继续循环查找）
    2.3 最优适应（全部遍历完，知道最优）
    2.4 隔离适应（将内存分割为不同级别大小的内存块，分配需求根据大小对应级别选择）（Go语言的内存分配策略相对类比这种策略）

3. 结合使用，内存块一次性申请，用于比较固定的内存申请使用，直接管理内存块。读写带来的锁等方面效率会急剧下降。 
    - C与Go混合使用的场景
    - 混合多种策略调度资源消耗
    - 带来内存空间浪费
    - 空间污染

### 垃圾收集

1. 标记清除
    分2个阶段，标记和清除，清除阶段STW（stop the world），清除阶段其余程序需要中断，存在长时间的STW。

2. 三色标记
    - 白色，潜在的垃圾
    - 黑色，活跃对象，没用引用其它对象
    - 灰色，活跃对象，存在引用其它的对象，垃圾收集器需要扫描对应的子对象

3. 三色标记的可能？
    - 存在引用，导致内存无法被垃圾收集收集并清除
    - 子对象遍历释放资源，同时执行垃圾回收















