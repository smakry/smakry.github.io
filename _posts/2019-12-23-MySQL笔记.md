---
layout: post
title: 'MySQL笔记'
date: 2018-12-23
author: smakry
tags: sql 阅读笔记
---

>  最流行关系型数据库管理系统

### 数值类型

MySQL中定义数据字段的类型数据库的优化是非常重要的，MySQL支持多种类型，大致可以分为三类：数值、时间/日期和字符串（字符）类型。
  
1. 一个字节8bit（ascii码起源？），符号位占1个bit
2. float 32bit浮点型变量（占4字节）在内存中的存储方式（<https://www.cnblogs.com/shangbolei/p/4441946.html>）：
一个浮点数由3个部分组成，符号位+指数部分e+底数部分m（32bit表示如下）：  
SEEE EEEE EMMM MMMM MMMM MMMM MMMM MMMM  
S：表示符号位，1负数，0正数  
E：exponent表示指数部分，占用8bit可表示0-255，但指数可正可负，所以IEEE规定8bit的E算出的值`需减去127才是真正的指数`。所以float的指数可从-126~128  
M：mantissa表示底数部分，实际占用24bit，但最高位固定是1所以省去不存储只存储23bit  
主意：这里有个特例，浮点数 为0时，指数和底数都为0，但此前的公式不成立。因为2的0次方为1，所以，0是个特例。当然，这个特例也不用认为去干扰，编译器会自动去识别。  

例如：-12.5（11000001 01001000 00000000 00000000）  

- s为1表示负数  
- E为1000001 0转成十进制是130，130-127=3，实际指数部分3  
- M为1001000 00000000 00000000，底数左边省略了一个1实际是1.10010000000000000000000  
- 到此3部分已提取，我们通过指数部分E的值来调整底数部分M的值。调整方法为：如果指数E为负数，底数的小数点向左移，如果指数E为正数，底数的小数点向右移。小数点移动的位数由指数E的`绝对值决定`，调整后为：  
1100.10000000000000000000   
小数点左边：1100转成10进制是12  
小数点右边计算：（1*2^-1 + 0*2^-2+...）10进制结果为.5（注意是从左往右）  


#### MySQL数值类型

![mysql数值类型]()

### Mysql四种事务隔离级别（众多Mysql存储引擎中，只有InnoDB支持事务）

#### 事务的基本要素

1.原子性（Atomicity）：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行中出错，会回滚到事务开始前到状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。  
2.一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏，比如A向B转账，不可能A扣了钱，B却没收到。  
3.隔离性（Isolation）：同一时间，只允许一个事务请求同一个数据，不同的事物之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱过程结束前，B不能向这张卡转账。  
4.持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。  

#### 事务的并发问题。

1.脏读：事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据。  
2.不可重复读：事务A多次读取同一数据，事务B在事务A多次读取的过程中，对数据做了更新并提交，导致事务A多次读取同一数据时，结果不一致。  
3.幻读：系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻听。  

小结：不可重复读的和幻读很容易混淆，`不可重复读侧重于修改`，`幻读侧重于新增和删除`。解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表。  

#### 隔离级别

事务隔离级别 					｜ 脏读 	｜ 不可重复读 ｜ 幻读  
读未提交（read-uncommitted）	｜ 是	｜ 是		｜ 是  
不可重复读（read-committed）	｜ 否	｜ 是		｜ 是  
可重复读（repeatable-read）	｜ 否 	｜ 否 		｜ 是  
串行化（serializable）		｜ 否	｜ 否		｜ 否  


默认的事务隔离级别是可重复读（repeatable-read）   
mysql> select @@tx_isolation;  

例子详解：  
<https://www.cnblogs.com/wyaokai/p/10921323.html>

  











