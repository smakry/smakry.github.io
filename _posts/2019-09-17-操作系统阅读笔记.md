---
layout: post
title: '操作系统阅读笔记'
date: 2019-09-17
author: smakry
tags: 操作系统 阅读笔记
---

> **管理**计算机硬件与软件资源的计算机程序，计算机系统的内核与基石

### 并发与并行？

1. 并行：在同一时刻，有多条指令在`多个处理器上`**同时**执行，从微观还是从宏观看，都是一起执行。

![并行](https://github.com/smakry/smakry.github.io/raw/master/imags/Cookie%E5%8E%9F%E7%90%86.png)

2. 并发：在同一时刻`只能有一条指令`执行，但多个进程指令被快速的`轮换执行`，宏观上具有多个进程同时执行的效果，但微观上并不是同时执行，只是把时间分成若干段，使多个进程快速交替的执行。  

![并发](https://github.com/smakry/smakry.github.io/raw/master/imags/Cookie%E5%8E%9F%E7%90%86.png)  

### 操作系统的四大特性

操作系统的四大特征：并发、共享、虚拟、异步  
1. 并发：在一段时间内，运行多个程序，执行多个任务，从宏观上来说，操作系统引入进程的目的就是为了使程序能并发执行。  
2. 共享：资源共享，系统中的资源可供多个`并发执行的进程`共同使用。由于资源的属性不同，多个进程对资源的共享方式也不同，可分为互斥共享方式和同时访问方式。  
- 互斥共享方式：一段时间内`只允许一个进程`访问该资源。  
- 同时共享方式：某些资源，一段时间内允许多个进程“同时”对它们进行访问，这个`“同时”是宏观上`的，在`微观上可能是分时共享`（eg：磁盘设备）。  
3. 虚拟：虚拟性是`一种管理技术`，把物理上的一个实体变成逻辑上的多个对应物，或把物理上的多个实体变成逻辑上的一个对应物的技术。采用虚拟技术的目的是为用户提供易于使用、方便高效的操作环境。虚，理解为用户感觉上的。   
4. 异步：在多道程序环境下，允许多个程序并发执行。但由于`资源有限`，进程的执行`不是一贯到底，而是走走停停`，已不可预知的速度向前推进。  
异步性使得操作系统运行在随机的环境下，`可能导致进程产生与时间相关的错误，但只要运行的环境相同，操作提供必须保证多次运行进程，都获得相同的结果`。  

### 进程与线程

#### 进程  

1. 多进程的组织形式：
    - PCB（Process Control Block，进程控制块）：`用来记录进程信息的数据结构`（管理进程的核心，包含了PID等进程的所有关键信息）
2. 进程的状态：就绪状态、执行状态、阻塞状态（多线程时也是这些状态）

![进程状态](https://github.com/smakry/smakry.github.io/raw/master/imags/Cookie%E5%8E%9F%E7%90%86.png)  

- 就绪->执行：处于就绪状态的进程，在调度程序为之分配了处理机之后便开始执行。  
- 执行->就绪：正在执行的进程如果因为分配他的`时间片已经用完`，而被`剥夺处理机`。  
- 执行->阻塞：如果因为某些原因致使当前的进程执行受阻，使之不能执行。

3. 队列：就绪队列、等待（阻塞）队列

##### CPU调度算法（在就绪队列中怎么挑选进程让CPU执行）  

- 周转时间：从开始申请执行任务，到执行`任务完成`。  
- 响应时间：从开始申请执行任务，到`开始执行`任务。 

决策模式说明选择函数在执行的数据的处理方式（一个调度算法是否能抢占，对进程的顺序有着极大的影响）：  

- 非抢占：一旦进入运行状态，就不会终止直到运行结束。
- 抢占式：当前正在运行的进程可以被打断，并转移到就绪态。 

1. FCFS（First Come First Service，先来先服务），非抢占式，根据进程到达时间决定先后。
2. SJF（Short Job First，最短进程优先）/又称SPN，非抢占式，根据`到达时间选择短作业`（即短作业在长作业运行期间到达也是长作业先执行）
3. SRT(Shortest Remaining Time,最短剩余时间优先)，抢占式，作业过程新进作业执行时间较短，`中断当前作业`（当前进入就绪，后续继续执行），新作业提上来优先执行。可以认为是优先级调度中的一种。
4. RR（Time Slicling，SL，时间片轮转）/又称轮转RR，抢占式，按到达的先后讲进程放入队列中，给队首进程分配CPU时间片，时间片用完之后计时器发出中断，暂停当前进程将其放入队尾，循环。
5. HRRN（Highest Response Ratio Next，高响应比优先调度），非抢占式，优先级调度中的一种。  
响应比 = （等待时间 + 服务时间）/ 服务时间  
6. 多级反馈队列调度算法：目前公认较好的调度算法，设置多个就绪队列并为每个队列设置不同的优先级，第一个队列的优先级最高，其余依次递减。优先级高的队列分配的时间片越短，进程到达之后按FCFS放入第一个队列，如果调度执行后没有完成，那么放到第2个`队列尾部`等待调度，如果第二次调度仍然没有完成，放入第3个队列尾部...。`只有当前队列为空的时候才会去调度下一个`队列的进程。  

#### 线程  

线程有自己的TCB（Thread Control Block，线程控制块），只负责这条流程的信息，包括PC程序计数器，SP栈，State状态，寄存器和线程ID。线程有`内核线程`和`用户级线程`，一般我们说的都是用户级线程，内核级线程由内核管理。  

- `只有内核级线程才能发挥多核性能`，因为内核级线程`共用一套MMU`（即内存映射表），统一分配核1核2（即有多个CPU，可以一个CPU执行一个内核级线程）。`进程无法发挥多核性能`，因为进程切换都得切MMU。
- 为什么需要内核级线程？如果只有用户级线程，在内核中只能看到进程，所以当用户级线程中一个线程进行IO读写阻塞时，内核会将该线程所在的进程直接切换。例如当用浏览器打开网页，这个进程中有下载数据线程，有显示数据线程，当数据下载读写阻塞时，内核直接切到qq（这些切换是指在CPU上运行的程序的切换）。  

 